<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Imkon ¬∑ ESG Pathfinder ‚Äî –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞</title>
<meta name="description" content="ESG Pathfinder ‚Äî —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ ESG –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π. 30 –≤–æ–ø—Ä–æ—Å–æ–≤ (10E/10S/10G). RU/EN. –†–∞—Å—á—ë—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ, —ç–∫—Å–ø–æ—Ä—Ç CSV/JSON, –ø–µ—á–∞—Ç—å PDF.">
<style>
  /* Webfont for consistent look (keeps local fonts if available) */
  @import url('https://fonts.googleapis.com/css2?family=Gothic+A1:wght@400;600;700;800&display=swap');
  :root{
    --brand:#7a1d2f; --brand-ink:#ffffff;
    --bg:#f6f6f7; --card:#ffffff; --ink:#111213; --muted:#5e6470; --border:#e3e6ea;
    --ok:#138a4b; --warn:#b77706; --bad:#b42318;
    --font:"Gothic A1", "Century Gothic", CenturyGothic, AppleGothic, "Segoe UI", Arial, Helvetica, sans-serif;
  }
  @media (prefers-color-scheme: dark){
    :root{ --bg:#0a0b0e; --card:#0f1115; --ink:#e9edf2; --muted:#9aa3af; --border:#202733; }
  }
  *{box-sizing:border-box}
  html,body{margin:0; background:var(--bg); color:var(--ink); font-family: var(--font);}  
  a{color:var(--brand); text-decoration:none}
  .wrap{max-width:980px; margin:28px auto; padding:0 16px}
  .header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
  .logo{display:flex; align-items:center; gap:10px}
  .logoMark{width:36px; height:36px; border-radius:10px; background:var(--brand); display:grid; place-items:center; color:var(--brand-ink); font-weight:800}
  .logoText{font-weight:800; letter-spacing:.2px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:18px}
  .sub{color:var(--muted); font-size:14px}
  .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
  .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--border) !important; border-radius:999px; font-size:12px; color:var(--muted)}
  .h1{font-size:24px; font-weight:800}
  .h2{font-size:18px; font-weight:700; margin:18px 0 8px}
  .grid{display:grid; gap:12px}
  .q{border:1px solid var(--border); border-radius:12px; padding:12px}
  .q h4{margin:0 0 8px 0; font-size:14px}
  .badge{padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#fff}
  .badge.ok{background:#ecfdf5; color:var(--ok); border-color:#a7f3d0}
  .badge.warn{background:#fffbeb; color:var(--warn); border-color:#fde68a}
  .badge.bad{background:#fef2f2; color:var(--bad); border-color:#fecaca}
  .actions{display:flex; gap:10px; flex-wrap:wrap}
  button, select, input[type="email"], input[type="text"]{ appearance:none; border-radius:10px; border:1px solid var(--border) !important; background:var(--card); color:var(--ink); padding:10px 12px; font-weight:600; min-height:40px; font-family: var(--font) }
  button.primary{background:var(--brand); color:var(--brand-ink); border:1px solid var(--brand) !important}
  button[disabled]{opacity:.6; cursor:not-allowed}
  .scores{display:grid; grid-template-columns: repeat(4, minmax(120px,1fr)); gap:12px; margin-top:12px}
  .scorebox{border:1px solid var(--border); border-radius:12px; padding:12px}
  .score{font-size:28px; font-weight:900}
  .bar{height:8px; background:#e5e7eb; border-radius:8px; overflow:hidden}
  .bar>div{height:100%}
  .muted{color:var(--muted)}
  details summary{cursor:pointer}
  .footer{margin-top:16px; font-size:12px; color:var(--muted)}
  .warning{background:#fffbeb; border:1px solid #fde68a; border-radius:8px; padding:10px; margin-top:10px; font-size:14px; color:#b77706}
  @media (max-width:720px){ .scores{grid-template-columns:1fr 1fr} }
  @media print{ .actions{display:none} body{background:#fff} .card{box-shadow:none} .warning{display:none} }
  /* Typography enforcement */
  *, *::before, *::after { font-family: inherit; }
  button:focus-visible, .pill:focus-visible, select:focus-visible, input:focus-visible { outline: 2px solid var(--brand); outline-offset: 2px; }
  button:hover{ filter:brightness(0.98); }
  button.primary:hover{ filter:brightness(0.96); }
  button, select, input, textarea, label { font-family: inherit; }
  /* Dev-only tests panel (hidden unless #dev in URL) */
  #tests{display:none; margin-top:12px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">
        <div class="logoMark">I</div>
        <div class="logoText">Imkon ¬∑ ESG Pathfinder</div>
      </div>
      <div class="row">
        <select id="lang">
          <option value="ru">–†—É—Å—Å–∫–∏–π</option>
          <option value="en">English</option>
        </select>
        <button id="reset">–°–±—Ä–æ—Å</button>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="h1" id="titleMain">ESG Pathfinder ‚Äî –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞</div>
          <div class="sub" id="subtitle">30 –≤–æ–ø—Ä–æ—Å–æ–≤ (10E/10S/10G) ¬∑ ~12 –º–∏–Ω—É—Ç ¬∑ RU/EN ¬∑ —Ä–∞—Å—á—ë—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</div>
        </div>
        <div class="row">
          <span id="pillPublic" class="pill">Public</span>
          <span id="pillPillars" class="pill">Pillars: E ‚Ä¢ S ‚Ä¢ G</span>
          <span id="pillScale" class="pill">Scale: 0 / 0.5 / 1</span>
        </div>
      </div>

      <!-- –î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ -->
      <div class="row" style="margin-top:10px">
        <input id="company" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏" style="flex:1" />
        <select id="sector" style="min-width:220px"></select>
        <select id="year" style="min-width:120px"></select>
      </div>

      <div id="sectorWarning" class="warning" style="display:none">
        <span id="sectorWarningText">‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Ä–∞—Å–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π ESG</span>
      </div>

      <div class="grid" id="questions" style="margin-top:12px"></div>

      <div class="row" style="margin-top:12px; gap:10px">
        <input id="userEmail" type="email" placeholder="–í–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="flex:1; min-width:200px" />
        <button id="consultation" style="white-space:nowrap">üìß –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</button>
      </div>

      <div class="actions" style="margin-top:12px">
        <button id="calc" class="primary" data-i="calc">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        <button id="exportCsv" data-i="exportCsv">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
        <button id="exportJson" data-i="exportJson">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
        <button id="printBtn" data-i="print">–ü–µ—á–∞—Ç—å / PDF</button>
      </div>

      <div id="results" style="display:none">
        <div class="h2" id="resTitle">–ò—Ç–æ–≥–∏</div>
        <div class="scores">
          <div class="scorebox"><div class="muted" id="lblAll">–ò—Ç–æ–≥–æ–≤—ã–π ESG</div><div class="score" id="scoreAll">‚Äì</div><div class="bar"><div id="barAll"></div></div></div>
          <div class="scorebox"><div class="muted" id="lblE">E ‚Äî –≠–∫–æ–ª–æ–≥–∏—è</div><div class="score" id="scoreE">‚Äì</div><div class="bar"><div id="barE"></div></div></div>
          <div class="scorebox"><div class="muted" id="lblS">S ‚Äî –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ</div><div class="score" id="scoreS">‚Äì</div><div class="bar"><div id="barS"></div></div></div>
          <div class="scorebox"><div class="muted" id="lblG">G ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div><div class="score" id="scoreG">‚Äì</div><div class="bar"><div id="barG"></div></div></div>
        </div>
        <details style="margin-top:12px">
          <summary id="recTitle">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</summary>
          <div id="advice" class="grid" style="margin-top:12px"></div>
        </details>
        <div class="footer" id="disclaimer">–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: —ç—Ç–∞ –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç.</div>

        <details id="tests">
          <summary>Dev tests</summary>
          <pre id="testlog"></pre>
        </details>
      </div>
    </div>
  </div>

<script>
(function(){
  // Text resources
  const L = {
    ru:{
      title:'ESG Pathfinder ‚Äî –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞',
      subtitle:'30 –≤–æ–ø—Ä–æ—Å–æ–≤ (10E/10S/10G) ¬∑ ~12 –º–∏–Ω—É—Ç ¬∑ RU/EN ¬∑ —Ä–∞—Å—á—ë—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ',
      public:'Public', pillars:'Pillars: E ‚Ä¢ S ‚Ä¢ G', scale:'Scale: 0 / 0.5 / 1',
      companyPH:'–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏', sectorPH:'–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Ä–∞—Å–ª—å',
      qHeader:'–í–æ–ø—Ä–æ—Å—ã', res:'–ò—Ç–æ–≥–∏', rec:'–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', disclaimer:'–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: —ç—Ç–∞ –≤–µ—Ä—Å–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç.',
      ELabel:'–≠–∫–æ–ª–æ–≥–∏—è (E)', SLabel:'–°–æ—Ü–∏–∞–ª—å–Ω–æ–µ (S)', GLabel:'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (G)',
      LAll:'–ò—Ç–æ–≥–æ–≤—ã–π ESG', LE:'E ‚Äî –≠–∫–æ–ª–æ–≥–∏—è', LS:'S ‚Äî –°–æ—Ü–∏–∞–ª—å–Ω–æ–µ', LG:'G ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',
      yes:'–î–∞', partial:'–ß–∞—Å—Ç–∏—á–Ω–æ', no:'–ù–µ—Ç', see:'–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å / –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:',
      calc:'–†–∞—Å—Å—á–∏—Ç–∞—Ç—å', exportCsv:'–≠–∫—Å–ø–æ—Ä—Ç CSV', exportJson:'–≠–∫—Å–ø–æ—Ä—Ç JSON', print:'–ü–µ—á–∞—Ç—å / PDF',
      sectorWarning:'‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Ä–∞—Å–ª—å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π ESG',
      emailPH:'–í–∞—à email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)', consultation:'üìß –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é'
    },
    en:{
      title:'ESG Pathfinder ‚Äî Self-assessment',
      subtitle:'30 questions (10E/10S/10G) ¬∑ ~12 minutes ¬∑ RU/EN ¬∑ computed locally in the browser',
      public:'Public', pillars:'Pillars: E ‚Ä¢ S ‚Ä¢ G', scale:'Scale: 0 / 0.5 / 1',
      companyPH:'Company name', sectorPH:'Choose a sector',
      qHeader:'Questions', res:'Results', rec:'Recommendations', disclaimer:'Disclaimer: this lite version is for quick orientation and does not replace a full audit.',
      ELabel:'Environment (E)', SLabel:'Social (S)', GLabel:'Governance (G)',
      LAll:'Overall ESG', LE:'E ‚Äî Environment', LS:'S ‚Äî Social', LG:'G ‚Äî Governance',
      yes:'Yes', partial:'Partial', no:'No', see:'Where to look / rationale:',
      calc:'Calculate', exportCsv:'Export CSV', exportJson:'Export JSON', print:'Print / PDF',
      sectorWarning:'‚ö†Ô∏è Please select a sector for correct ESG weighting',
      emailPH:'Your email (optional)', consultation:'üìß Request consultation'
    }
  };

  // Sector weights
  const W = {banks:{E:.3,S:.35,G:.35}, manufacturing:{E:.45,S:.3,G:.25}, mining:{E:.5,S:.3,G:.2}, services:{E:.25,S:.35,G:.4}, other:{E:.33,S:.34,G:.33}};

  // Questions (30)
  const Q = {
    ru:{
      E:[{code:'E1',q:'–ï—Å—Ç—å –ª–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –ø—Ä—è–º—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤ (Scope 1) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥?',tip:'–û—Ç—á—ë—Ç –ø–æ –ü–ì/ISO 14064-1; —Ç–æ–ø–ª–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏; –±–∞–∑–∞ ‚Äî GHG Protocol.'},{code:'E2',q:'–£—á—Ç–µ–Ω—ã –∫–æ—Å–≤–µ–Ω–Ω—ã–µ –≤—ã–±—Ä–æ—Å—ã –æ—Ç —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ (Scope 2)?',tip:'–°—á–µ—Ç–∞ –∑–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏—é, –¥–æ–≥–æ–≤–æ—Ä—ã/–ü–ü–ê; –º–µ—Ç–æ–¥ ‚Äî Scope 2.'},{code:'E3',q:'–û—Ü–µ–Ω–µ–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ Scope 3?',tip:'ERP –∑–∞–∫—É–ø–æ–∫, –ª–æ–≥–∏—Å—Ç–∏–∫–∞, –ø–æ–¥—Ä—è–¥—á–∏–∫–∏; —Å–ø–∏—Å–æ–∫ 15 –∫–∞—Ç–µ–≥–æ—Ä–∏–π.'},{code:'E4',q:'–ï—Å—Ç—å —Ü–µ–ª–∏ –∏ –ø–ª–∞–Ω —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å –±–∞–∑–æ–≤—ã–º –≥–æ–¥–æ–º?',tip:'–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–µ–∫–∞—Ä–±–æ–Ω–∏–∑–∞—Ü–∏–∏, SMART, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –°–æ–≤–µ—Ç–∞.'},{code:'E5',q:'–î–æ–ª—è –í–ò–≠ ‚â•20% –∏–ª–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω –ø–ª–∞–Ω?',tip:'–°—á—ë—Ç—á–∏–∫–∏/—Å—á–µ—Ç–∞, PPA, –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è.'},{code:'E6',q:'–≠–Ω–µ—Ä–≥–æ–∞—É–¥–∏—Ç –∏ KPI —ç–Ω–µ—Ä–≥–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏?',tip:'EMS/SCADA, –æ—Ç—á–µ—Ç—ã —ç–Ω–µ—Ä–≥–æ–∞—É–¥–∏—Ç–∞, KPI —Ü–µ—Ö–æ–≤.'},{code:'E7',q:'–£—á—ë—Ç –≤–æ–¥—ã –∏ —Ü–µ–ª–∏ –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é/–ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é?',tip:'–°—á—ë—Ç—á–∏–∫–∏, –≤–æ–¥–Ω—ã–µ –ø–∞—Å–ø–æ—Ä—Ç–∞, —Ç–µ—Ö–∫–∞—Ä—Ç—ã.'},{code:'E8',q:'–£—á—ë—Ç –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Ö–æ–¥–∞–º–∏, –¥–æ–ª—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏?',tip:'–†–µ–µ—Å—Ç—Ä –æ—Ç—Ö–æ–¥–æ–≤, –¥–æ–≥–æ–≤–æ—Ä—ã —Å —É—Ç–∏–ª–∏–∑–∞—Ç–æ—Ä–∞–º–∏, –ú–°–£–û.'},{code:'E9',q:'–û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ/–∑–µ–º–ª–µ–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ?',tip:'–û–í–û–°/ESIA, –≥–µ–æ–¥–∞–Ω–Ω—ã–µ, –û–û–ü–¢.'},{code:'E10',q:'–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—è–∑–Ω–∏—Ç–µ–ª–µ–π/—à—É–º–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞–º?',tip:'–õ–∞–±. –∂—É—Ä–Ω–∞–ª—ã, –ü–î–í/–ü–î–°, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.'}],
      S:[{code:'S1',q:'–û—Ö—Ä–∞–Ω–∞ —Ç—Ä—É–¥–∞: —Ü–µ–ª–∏ (TRIR/LTIFR), —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ —Ñ–∞–∫—Ç—ã?',tip:'HSE-–æ—Ç—á–µ—Ç—ã, –∂—É—Ä–Ω–∞–ª—ã –ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–π, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.'},{code:'S2',q:'–ì–µ–Ω–¥–µ—Ä–Ω—ã–π —Å–æ—Å—Ç–∞–≤/–¥–æ–ª—è –∂–µ–Ω—â–∏–Ω –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ —Å —Ü–µ–ª—è–º–∏?',tip:'HR-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ä–≥—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –æ—Ç—á–µ—Ç—ã.'},{code:'S3',q:'–†–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –∂–∞–ª–æ–± (–≤ —Ç.—á. –∞–Ω–æ–Ω–∏–º–Ω—ã–π), PSEA/GBVH?',tip:'–†–µ–≥–ª–∞–º–µ–Ω—Ç, –∫–∞–Ω–∞–ª/–±–æ—Ç, —Ä–µ–µ—Å—Ç—Ä –æ–±—Ä–∞—â–µ–Ω–∏–π.'},{code:'S4',q:'–ï–∂–µ–≥–æ–¥–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (‚â•8 —á/—Å–æ—Ç—Ä.) –ø–æ ESG/—ç—Ç–∏–∫–µ/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?',tip:'LMS/—Ä–µ–µ—Å—Ç—Ä –æ–±—É—á–µ–Ω–∏–π, —Ç–µ—Å—Ç—ã, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã.'},{code:'S5',q:'–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤?',tip:'–ü–æ–ª–∏—Ç–∏–∫–∞ —Å–Ω–∞–±–∂–µ–Ω–∏—è, –¥–æ–≥–æ–≤–æ—Ä—ã, –∞—É–¥–∏—Ç—ã/–∞–Ω–∫–µ—Ç—ã.'},{code:'S6',q:'–ü–ª–∞–Ω—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–æ–æ–±—â–µ—Å—Ç–≤–æ–º (SEP)?',tip:'SEP, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –≤—Å—Ç—Ä–µ—á, –∫–∞—Ä—Ç–∞ —Å—Ç–µ–π–∫—Ö–æ–ª–¥–µ—Ä–æ–≤.'},{code:'S7',q:'–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö/–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è?',tip:'–ü–æ–ª–∏—Ç–∏–∫–∞ –ò–ë/–ü–î, —Å–æ–≥–ª–∞—à–µ–Ω–∏—è, –æ—Ç—á–µ—Ç—ã –ò–ë.'},{code:'S8',q:'–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–∞—è –æ–ø–ª–∞—Ç–∞ –∏ –∞–Ω—Ç–∏-–¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è?',tip:'–ì—Ä–µ–π–¥—ã/–≤–∏–ª–∫–∏, DEI-–ø–æ–ª–∏—Ç–∏–∫–∞, –∞—É–¥–∏—Ç –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–π.'},{code:'S9',q:'–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞–∫—Ç–∏–∫ —Ç—Ä—É–¥–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤?',tip:'–ê—É–¥–∏—Ç—ã —Ü–µ–ø–æ—á–∫–∏ –ø–æ—Å—Ç–∞–≤–æ–∫, –∞–Ω–∫–µ—Ç—ã, —É—Å–ª–æ–≤–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.'},{code:'S10',q:'–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤: KPI, —Ä–µ–∫–ª–∞–º–∞—Ü–∏–∏, CAPA?',tip:'QMS, –∂—É—Ä–Ω–∞–ª —Ä–µ–∫–ª–∞–º–∞—Ü–∏–π, CAPA-—Ä–µ–µ—Å—Ç—Ä.'}],
      G:[{code:'G1',q:'–ö–æ–¥–µ–∫—Å —ç—Ç–∏–∫–∏ –∏ –ü–æ–ª–∏—Ç–∏–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –°–æ–≤–µ—Ç–æ–º?',tip:'–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –°–æ–≤–µ—Ç–∞, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã.'},{code:'G2',q:'–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –°–æ–≤–µ—Ç–∞: ‚â•1/3 (–∏–ª–∏ ‚â•30% –¥–ª—è –ì–ü)?',tip:'–°–æ—Å—Ç–∞–≤ –°–æ–≤–µ—Ç–∞, —Å—Ç–∞—Ç—É—Å—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤.'},{code:'G3',q:'–ï—Å—Ç—å –∫–æ–º–∏—Ç–µ—Ç –°–æ–≤–µ—Ç–∞ –ø–æ —É—Å—Ç–æ–π—á–∏–≤–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é/ESG?',tip:'–ü–æ–ª–æ–∂–µ–Ω–∏–µ, –ø–ª–∞–Ω —Ä–∞–±–æ—Ç—ã, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã.'},{code:'G4',q:'–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ ESG KPI?',tip:'–ü–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è, KPI-–ª–∏—Å—Ç—ã.'},{code:'G5',q:'–ö–∞–Ω–∞–ª whistleblowing –∏ –µ–∂–µ–≥–æ–¥–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å?',tip:'–ö–∞–Ω–∞–ª/–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —Ä–µ–≥–ª–∞–º–µ–Ω—Ç, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.'},{code:'G6',q:'ESG-—Ä–∏—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ ERM/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞—É–¥–∏—Ç?',tip:'–ú–∞—Ç—Ä–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤, –æ—Ç—á–µ—Ç—ã –í–ê, —Ä–µ–µ—Å—Ç—Ä –∫–æ–Ω—Ç—Ä–æ–ª—è.'},{code:'G7',q:'–†–∞—Å–∫—Ä—ã—Ç–∏–µ –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ —Å –∞—Å—Å—é—Ä–∞–Ω—Å–æ–º?',tip:'–û—Ç—á–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è, –∑–∞–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ.'},{code:'G8',q:'–°–∞–Ω–∫—Ü–∏–∏/–∞–Ω—Ç–∏–∫–æ—Ä—Ä—É–ø—Ü–∏—è –∏ KYC/AML —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è?',tip:'–ü–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–º–ø–ª–∞–µ–Ω—Å–∞, KYC/AML-–æ—Ç—á–µ—Ç—ã.'},{code:'G9',q:'–ö–∏–±–µ—Ä—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –ò–ë-–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º –Ω–∞ –°–æ–≤–µ—Ç–µ?',tip:'–û—Ç—á–µ—Ç—ã CISO, –º–µ—Ç—Ä–∏–∫–∏ –ò–ë.'},{code:'G10',q:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?',tip:'–ü–æ–ª–∏—Ç–∏–∫–∞, —Ä–µ–µ—Å—Ç—Ä –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–π, –∞—É–¥–∏—Ç—ã.'}]
    },
    en:{
      E:[{code:'E1',q:'Do you inventory direct emissions (Scope 1) for the latest year?',tip:'GHG inventory / ISO 14064-1; fuel records; baseline: GHG Protocol.'},{code:'E2',q:'Are electricity-related emissions (Scope 2) accounted?',tip:'Electricity bills, PPAs; Scope 2 method.'},{code:'E3',q:'Have you assessed material Scope 3 categories?',tip:'ERP/procurement, logistics, contractors; 15 categories list.'},{code:'E4',q:'Do you have reduction targets with a base year?',tip:'Decarbonization roadmap, SMART, board minutes.'},{code:'E5',q:'Is renewable electricity share >=20% or a plan in place?',tip:'Meters/bills, PPAs, guarantees of origin.'},{code:'E6',q:'Energy audit and intensity KPIs?',tip:'EMS/SCADA, audit reports, site KPIs.'},{code:'E7',q:'Water tracking and reduction/reuse targets?',tip:'Meters, water passports, process sheets.'},{code:'E8',q:'Waste tracking and recycling rate?',tip:'Waste register, licensed disposers, manifests.'},{code:'E9',q:'Biodiversity/land-use impact assessment?',tip:'EIA/ESIA, geodata, protected areas.'},{code:'E10',q:'Air/noise/pollutant monitoring and compliance?',tip:'Lab logs, permits/limits, production control.'}],
      S:[{code:'S1',q:'OH&S: targets (TRIR/LTIFR), investigations, public actuals?',tip:'HSE reports, incident logs, committee minutes.'},{code:'S2',q:'Gender mix and women in leadership with targets?',tip:'HR analytics, org chart, HR reports.'},{code:'S3',q:'Grievance mechanism (incl. anonymous), PSEA/GBVH?',tip:'Policy, channel/bot, case register.'},{code:'S4',q:'Annual training (>=8 h/employee) in ESG/ethics/safety?',tip:'LMS/training registry, tests, certificates.'},{code:'S5',q:'Responsible sourcing and supplier checks?',tip:'Procurement policy, contracts, audits/questionnaires.'},{code:'S6',q:'Community engagement plans (SEP)?',tip:'SEP, meeting minutes, stakeholder map.'},{code:'S7',q:'Data protection & privacy followed?',tip:'IS/PD policy, agreements, security reports.'},{code:'S8',q:'Fair pay and anti-discrimination controls?',tip:'Pay bands/grades, DEI policy, comp audits.'},{code:'S9',q:'Supplier labor/OH&S practices monitored?',tip:'Supply chain audits/questionnaires, clauses.'},{code:'S10',q:'Customer safety/quality: KPIs, complaints, CAPA?',tip:'QMS, complaints log, CAPA registers.'}],
      G:[{code:'G1',q:'Board-approved Code of Ethics and Sustainability Policy?',tip:'Board minutes/resolutions, published docs.'},{code:'G2',q:'Board independence: >=1/3 (or >=30% for SOEs)?',tip:'Board composition, director status.'},{code:'G3',q:'Board ESG/Sustainability committee?',tip:'Charter, workplan, minutes.'},{code:'G4',q:'Executive pay linked to ESG KPIs?',tip:'Remuneration policy, KPI sheets.'},{code:'G5',q:'Whistleblowing channel and annual reporting?',tip:'Channel/platform, policy, stats.'},{code:'G6',q:'ESG risks integrated into ERM/internal audit?',tip:'Risk matrix, IA reports, control register.'},{code:'G7',q:'Non-financial reporting with assurance?',tip:'Sustainability report, assurance statement.'},{code:'G8',q:'Sanctions/anti-corruption and KYC/AML in place?',tip:'Compliance policies, KYC/AML logs.'},{code:'G9',q:'Cyber governance and incident reporting to the Board?',tip:'CISO reports, IS metrics.'},{code:'G10',q:'Conflict-of-interest policy applied?',tip:'Policy, declaration register, audits.'}]
    }
  };

  // Elements
  const langSel = document.getElementById('lang');
  const qWrap = document.getElementById('questions');
  const calcBtn = document.getElementById('calc');
  const resetBtn = document.getElementById('reset');
  const exportCsvBtn = document.getElementById('exportCsv');
  const exportJsonBtn = document.getElementById('exportJson');
  const resultsEl = document.getElementById('results');
  const sectorWarningEl = document.getElementById('sectorWarning');
  const sectorWarningText = document.getElementById('sectorWarningText');

  function fillYear(){
    const yearSel = document.getElementById('year'); yearSel.innerHTML=''; const y=new Date().getFullYear();
    for(let i=0;i<5;i++){ const o=document.createElement('option'); o.value=String(y-i); o.textContent=String(y-i); yearSel.appendChild(o); }
  }
  function fillSector(lang){
    const sector=document.getElementById('sector'); sector.innerHTML='';
    const ph=document.createElement('option'); ph.value=''; ph.textContent=(lang==='ru'?'–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç—Ä–∞—Å–ª—å':'Choose a sector'); ph.disabled=true; ph.selected=true; sector.appendChild(ph);
    const opts = (lang==='ru') ? [['banks','–ë–∞–Ω–∫ / –§–∏–Ω–∞–Ω—Å—ã'],['manufacturing','–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ'],['mining','–ì–æ—Ä–Ω–æ–¥–æ–±—ã–≤–∞—é—â–∞—è'],['services','–£—Å–ª—É–≥–∏ / IT'],['other','–î—Ä—É–≥–æ–µ']] : [['banks','Banking / Finance'],['manufacturing','Manufacturing'],['mining','Mining'],['services','Services / IT'],['other','Other']];
    opts.forEach(([v,t])=>{ const o=document.createElement('option'); o.value=v; o.textContent=t; sector.appendChild(o); });
  }
  function localize(lang){
    const t=L[lang];
    document.getElementById('titleMain').textContent=t.title;
    document.getElementById('subtitle').textContent=t.subtitle;
    document.getElementById('pillPublic').textContent=t.public;
    document.getElementById('pillPillars').textContent=t.pillars;
    document.getElementById('pillScale').textContent=t.scale;
    document.getElementById('resTitle').textContent=t.res;
    document.getElementById('lblAll').textContent=t.LAll;
    document.getElementById('lblE').textContent=t.LE;
    document.getElementById('lblS').textContent=t.LS;
    document.getElementById('lblG').textContent=t.LG;
    document.getElementById('recTitle').textContent=t.rec;
    document.getElementById('disclaimer').textContent=t.disclaimer;
    document.getElementById('company').placeholder=t.companyPH;
    document.getElementById('userEmail').placeholder=t.emailPH;
    sectorWarningText.textContent=t.sectorWarning;
    // Buttons localization
    const bCalc=document.getElementById('calc'); if(bCalc) bCalc.textContent=t.calc;
    const bCsv=document.getElementById('exportCsv'); if(bCsv) bCsv.textContent=t.exportCsv;
    const bJson=document.getElementById('exportJson'); if(bJson) bJson.textContent=t.exportJson;
    const bPrint=document.getElementById('printBtn'); if(bPrint) bPrint.textContent=t.print;
    const bConsult=document.getElementById('consultation'); if(bConsult) bConsult.textContent=t.consultation;
    fillSector(lang);
  }
  function renderQuestions(lang){
    const t=L[lang]; qWrap.innerHTML='';
    const qh=document.createElement('div'); qh.className='h2'; qh.textContent=t.qHeader; qWrap.appendChild(qh);
    [['E',t.ELabel],['S',t.SLabel],['G',t.GLabel]].forEach(([pillar,label])=>{
      const hdr=document.createElement('div'); hdr.className='h2'; hdr.textContent=label; qWrap.appendChild(hdr);
      Q[lang][pillar].forEach(item=>{
        const div=document.createElement('div'); div.className='q';
        div.innerHTML = '<h4><span style="font-weight:700">'+item.code+'</span> ‚Äî '+item.q+'</h4>'+
          '<div class="row">'+
          '<label class="badge"><input type="radio" name="'+item.code+'" value="1"> '+t.yes+'</label>'+
          '<label class="badge warn"><input type="radio" name="'+item.code+'" value="0.5"> '+t.partial+'</label>'+
          '<label class="badge bad"><input type="radio" name="'+item.code+'" value="0"> '+t.no+'</label>'+
          '</div>'+
          '<div class="muted" style="margin-top:6px"><strong>'+t.see+'</strong> '+item.tip+'</div>';
        qWrap.appendChild(div);
      });
    });
  }

  function calc(){
    const lang=langSel.value;
    const sectorVal = document.getElementById('sector').value;
    
    // Show warning if no sector selected
    if(!sectorVal){
      sectorWarningEl.style.display='block';
      setTimeout(()=>{ sectorWarningEl.style.display='none'; }, 5000);
    }

    const groups={E:[],S:[],G:[]};
    ['E','S','G'].forEach(g=>{ Q[lang][g].forEach(it=>{ const v=parseFloat((document.querySelector('input[name="'+it.code+'"]:checked')||{}).value||'0'); groups[g].push(v); }); });
    const avg = g=> groups[g].reduce((a,b)=>a+b,0)/groups[g].length;
    const sE=avg('E'), sS=avg('S'), sG=avg('G');
    const w = W[sectorVal || 'other'];
    const overall = (sE*w.E + sS*w.S + sG*w.G);

    document.getElementById('scoreE').textContent=(sE*5).toFixed(1);
    document.getElementById('scoreS').textContent=(sS*5).toFixed(1);
    document.getElementById('scoreG').textContent=(sG*5).toFixed(1);
    document.getElementById('scoreAll').textContent=(overall*5).toFixed(1);
    document.getElementById('barE').style.width=(sE*100)+'%';
    document.getElementById('barS').style.width=(sS*100)+'%';
    document.getElementById('barG').style.width=(sG*100)+'%';
    document.getElementById('barAll').style.width=(overall*100)+'%';
    document.getElementById('barE').style.background = (sE>=.7?'#86efac':(sE>=.4?'#fde68a':'#fecaca'));
    document.getElementById('barS').style.background = (sS>=.7?'#86efac':(sS>=.4?'#fde68a':'#fecaca'));
    document.getElementById('barG').style.background = (sG>=.7?'#86efac':(sG>=.4?'#fde68a':'#fecaca'));
    document.getElementById('barAll').style.background = (overall>=.7?'#86efac':(overall>=.4?'#fde68a':'#fecaca'));

    const adv = document.getElementById('advice'); adv.innerHTML='';

    // Quick summary
    const sums={E:0,S:0,G:0}, counts={E:Q[lang].E.length,S:Q[lang].S.length,G:Q[lang].G.length};
    ['E','S','G'].forEach(g=>{ Q[lang][g].forEach(it=>{ const v=parseFloat((document.querySelector('input[name="'+it.code+'"]:checked')||{}).value||'0'); sums[g]+=v; }); });
    const avgs=[[sums.E/counts.E,'E'],[sums.S/counts.S,'S'],[sums.G/counts.G,'G']].sort((a,b)=>a[0]-b[0]);
    const weakest=avgs[0][1]; const missing = (counts.E+counts.S+counts.G) - (sums.E+sums.S+sums.G);

    const sectorSel=document.getElementById('sector');
    const sectorText=(sectorSel.options[sectorSel.selectedIndex]||{}).text||'';

    const score5 = (x)=> (x*5).toFixed(1);
    const band = (x)=> x>=.8 ? (lang==='ru'?'–°–∏–ª—å–Ω—ã–π':'Strong') : x>=.6 ? (lang==='ru'?'–°—Ä–µ–¥–Ω–∏–π':'Medium') : x>=.4 ? (lang==='ru'?'–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ':'Below avg') : (lang==='ru'?'–°–ª–∞–±—ã–π':'Weak');

    const desc = (lang==='ru')
      ? `–°–µ–∫—Ç–æ—Ä: ${sectorText||'‚Äî'} ¬∑ –í–µ—Å E/S/G: ${Math.round((w.E||0)*100)}%/${Math.round((w.S||0)*100)}%/${Math.round((w.G||0)*100)}%`
      : `Sector: ${sectorText||'‚Äî'} ¬∑ Weights E/S/G: ${Math.round((w.E||0)*100)}%/${Math.round((w.S||0)*100)}%/${Math.round((w.G||0)*100)}%`;

    // Top-3 weakest items where value < 1
    const weakItems=[];
    ['E','S','G'].forEach(g=>{
      Q[lang][g].forEach(it=>{
        const v=parseFloat((document.querySelector(`input[name="${it.code}"]:checked`)||{}).value||'0');
        if(v<1) weakItems.push({code:it.code, g, v, q:it.q});
      });
    });
    weakItems.sort((a,b)=> a.v - b.v); // 0 first, then 0.5
    const top3=weakItems.slice(0,3);

    const sumTitle = (lang==='ru'?'–ö–æ—Ä–æ—Ç–∫–∏–π —Å–∞–º–º–∞—Ä–∏':'Quick summary');
    const sumBody = (lang==='ru'
      ? `–í—Å–µ–≥–æ –ø—É–Ω–∫—Ç–æ–≤ –∫ —É–ª—É—á—à–µ–Ω–∏—é: ${missing.toFixed(0)}. –°–ª–∞–±–µ–π—à–∏–π —Å—Ç–æ–ª–ø: ${weakest} (${band(weakest==='E'?sE:weakest==='S'?sS:sG)}).\n–°—Ä–µ–¥–Ω–∏–µ –±–∞–ª–ª—ã (0‚Äì5): E=${score5(sE)}, S=${score5(sS)}, G=${score5(sG)}, ESG=${score5(overall)}.`
      : `Items to improve: ${missing.toFixed(0)}. Weakest pillar: ${weakest} (${band(weakest==='E'?sE:weakest==='S'?sS:sG)}).\nAverage scores (0‚Äì5): E=${score5(sE)}, S=${score5(sS)}, G=${score5(sG)}, ESG=${score5(overall)}.`);

    const priTitle = (lang==='ru'?'–¢–æ–ø‚Äë3 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞':'Top‚Äë3 priorities');
    const priList = top3.length? ('<ul style="margin:6px 0 0 18px">'+ top3.map(it=>`<li><strong>${it.code}</strong> (${it.g}) ‚Äî ${it.q}</li>`).join('') + '</ul>') : (lang==='ru'?'–í—Å–µ –ø—É–Ω–∫—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã. –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!':'All items complete. Great job!');

    const nextTitle = (lang==='ru'?'–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ':'What to do next');
    const nextBody = (lang==='ru'
      ? '1) –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ —Å—Ä–æ–∫–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º. 2) –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω—É—é –±–∞–∑—É (–ø–æ–ª–∏—Ç–∏–∫–∏/–ø—Ä–æ—Ç–æ–∫–æ–ª—ã/–¥–∞–Ω–Ω—ã–µ). 3) –ü–µ—Ä–µ—Å—á–∏—Ç–∞–π—Ç–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —á–µ—Ä–µ–∑ 90 –¥–Ω–µ–π.'
      : '1) Assign owners and deadlines for priorities. 2) Prepare evidence (policies/minutes/data). 3) Re-score in 90 days.');

    const summaryHtml = `
      <strong>${sumTitle}</strong>
      <div class="muted" style="white-space:pre-line">${desc}\n${sumBody}</div>
      <div style="margin-top:8px"><strong>${priTitle}</strong>${priList}</div>
      <div style="margin-top:8px"><strong>${nextTitle}</strong><div class="muted">${nextBody}</div></div>
    `;
    const summary=document.createElement('div'); summary.className='q'; summary.innerHTML = summaryHtml; adv.appendChild(summary);

    function rec(code){
      const R = {
        ru:{E1:'–°–æ–±—Ä–∞—Ç—å Scope 1 –∏ —É—Ç–≤–µ—Ä–¥–∏—Ç—å –±–∞–∑–æ–≤—ã–π –≥–æ–¥.',E2:'–£—á–µ—Å—Ç—å Scope 2 (location/market-based).',E3:'–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å Scope 3 –∏ –Ω–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã.',E4:'–£—Ç–≤–µ—Ä–¥–∏—Ç—å SMART-—Ü–µ–ª–∏ –∏ –¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É.',E5:'–£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ–ª—é –í–ò–≠ –∏–ª–∏ —É—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω.',E6:'–≠–Ω–µ—Ä–≥–æ–∞—É–¥–∏—Ç –∏ KPI —ç–Ω–µ—Ä–≥–æ–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏.',E7:'–£—á—ë—Ç –≤–æ–¥—ã –∏ —Ü–µ–ª–∏ —Å–Ω–∏–∂–µ–Ω–∏—è/–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.',E8:'–£—á—ë—Ç –æ—Ç—Ö–æ–¥–æ–≤ –∏ —Ä–æ—Å—Ç –¥–æ–ª–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏.',E9:'–û—Ü–µ–Ω–∫–∞ –±–∏–æ—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –ø–ª–æ—â–∞–¥–æ–∫.',E10:'–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—è–∑–Ω–∏—Ç–µ–ª–µ–π/—à—É–º–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.',S1:'–¶–µ–ª–∏ –ø–æ –û–¢ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.',S2:'–¶–µ–ª–∏ –ø–æ –¥–æ–ª–µ –∂–µ–Ω—â–∏–Ω –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ.',S3:'–ú–µ—Ö–∞–Ω–∏–∑–º –∂–∞–ª–æ–± —Å –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å—é –∏ SLA.',S4:'–ì–æ–¥–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏–Ω–≥–∏ (>=8 —á/—Å–æ—Ç—Ä.) –∏ —Ä–µ–µ—Å—Ç—Ä.',S5:'–ü–æ–ª–∏—Ç–∏–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏.',S6:'–û–±–Ω–æ–≤–∏—Ç—å SEP –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π.',S7:'–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –ò–ë/–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.',S8:'–ê—É–¥–∏—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –æ–ø–ª–∞—Ç—ã –∏ –∞–Ω—Ç–∏-–¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏–∏.',S9:'–ê—É–¥–∏—Ç—ã —É—Å–ª–æ–≤–∏–π —Ç—Ä—É–¥–∞ —É –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤.',S10:'KPI –∫–∞—á–µ—Å—Ç–≤–∞/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, CAPA, –∞–Ω–∞–ª–∏–∑ —Ä–µ–∫–ª–∞–º–∞—Ü–∏–π.',G1:'–£—Ç–≤–µ—Ä–¥–∏—Ç—å –ö–æ–¥–µ–∫—Å —ç—Ç–∏–∫–∏ –∏ –ü–æ–ª–∏—Ç–∏–∫—É —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è.',G2:'–£—Å–∏–ª–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –°–æ–≤–µ—Ç–∞ –∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ.',G3:'–£—á—Ä–µ–¥–∏—Ç—å –∫–æ–º–∏—Ç–µ—Ç –°–æ–≤–µ—Ç–∞ –ø–æ —É—Å—Ç–æ–π—á–∏–≤–æ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é.',G4:'–ü—Ä–∏–≤—è–∑–∞—Ç—å —á–∞—Å—Ç—å –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –∫ ESG KPI.',G5:'–í–≤–µ—Å—Ç–∏ –∫–∞–Ω–∞–ª whistleblowing –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å.',G6:'–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å ESG-—Ä–∏—Å–∫–∏ –≤ ERM –∏ –í–ê.',G7:'–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –Ω–µ—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å –∞—Å—Å—é—Ä–∞–Ω—Å–æ–º.',G8:'–û–±–Ω–æ–≤–∏—Ç—å —Å–∞–Ω–∫—Ü–∏–∏/–∞–Ω—Ç–∏–∫–æ—Ä—Ä—É–ø—Ü–∏—é –∏ KYC/AML.',G9:'–†–µ–≥—É–ª—è—Ä–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –ò–ë-–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º –≤ –°–æ–≤–µ—Ç.',G10:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤ –∏ —Ä–µ–µ—Å—Ç—Ä –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–π.'},
        en:{E1:'Compile Scope 1 and set a base year.',E2:'Account Scope 2 (location/market-based).',E3:'Prioritize Scope 3 and start calculations.',E4:'Approve SMART targets and roadmap.',E5:'Increase renewables or approve a plan.',E6:'Run energy audit and intensity KPIs.',E7:'Track water and set reduction/reuse targets.',E8:'Track waste and increase recycling.',E9:'Assess biodiversity for key sites.',E10:'Monitor pollutants/noise and compliance.',S1:'Set OH&S targets and standardize investigations.',S2:'Set targets for women in leadership.',S3:'Grievance mechanism with anonymity and SLAs.',S4:'Annual trainings (>=8 h/employee) and registry.',S5:'Responsible sourcing policy and supplier checks.',S6:'Update SEP and engagement calendar.',S7:'Update data protection/cybersecurity policy.',S8:'Audit pay equity and anti-discrimination.',S9:'Supplier labor/OH&S audits.',S10:'Quality/safety KPIs, CAPA, complaint analysis.',G1:'Approve Code of Ethics and Sustainability Policy.',G2:'Increase Board independence and disclosure.',G3:'Establish Board ESG/Sustainability committee.',G4:'Link executive pay to ESG KPIs.',G5:'Introduce whistleblowing channel and reporting.',G6:'Integrate ESG risks into ERM and IA.',G7:'Publish non-financial report with assurance.',G8:'Update sanctions/anti-corruption and KYC/AML.',G9:'Report cybersecurity incidents to the Board.',G10:'Apply conflict-of-interest policy and register.'}
      };
      return (lang==='ru'?R.ru:R.en)[code]||'';
    }

    ['E','S','G'].forEach(g=>{ Q[lang][g].forEach(it=>{ const v=parseFloat((document.querySelector('input[name="'+it.code+'"]:checked')||{}).value||'0'); if(v<1){ const c=document.createElement('div'); c.className='q'; c.innerHTML = '<div class="badge">'+g+'</div> <strong>'+it.code+'</strong><div class="muted">'+rec(it.code)+'</div>'; adv.appendChild(c);} }); });

    resultsEl.style.display='block';
  }

  // Helper for tests and export
  function buildCsv(rows){
    return rows.map(r=> r.map(x=> '"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\n');
  }

  function toCsv(){
    const lang=langSel.value; 
    const rows=[["Company","Year","Sector","Pillar","Code","Question","Answer (0-1)","Score (0-5)"]];
    const company=(document.getElementById('company').value||''); 
    const year=(document.getElementById('year').value||''); 
    const sector=(document.getElementById('sector').value||'');
    ['E','S','G'].forEach(g=>{ 
      Q[lang][g].forEach(it=>{ 
        const el=document.querySelector('input[name="'+it.code+'"]:checked'); 
        const v=parseFloat(el?el.value:'0'); 
        rows.push([company,year,sector,g,it.code,it.q,String(v),(v*5).toFixed(1)]); 
      }); 
    });
    const csv = buildCsv(rows);
    // Add BOM for proper Cyrillic encoding in Excel
    const blob = new Blob(['\uFEFF' + csv],{type:'text/csv;charset=utf-8;'}); 
    const a=document.createElement('a'); 
    a.href=URL.createObjectURL(blob); 
    a.download='ESG_Self_Assessment_'+(company||'Company')+'_'+(year||'')+'.csv'; 
    a.click();
  }
  
  function toJson(){
    const lang=langSel.value; 
    const data={
      company:document.getElementById('company').value||'', 
      year:document.getElementById('year').value||'', 
      sector:document.getElementById('sector').value||'', 
      answers:[], 
      scores:{}
    };
    ['E','S','G'].forEach(g=>{ 
      Q[lang][g].forEach(it=>{ 
        const el=document.querySelector('input[name="'+it.code+'"]:checked'); 
        const v=parseFloat(el?el.value:'0'); 
        data.answers.push({pillar:g, code:it.code, q:it.q, value:v, score5:+(v*5).toFixed(1)}); 
      }); 
    });
    const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); 
    const a=document.createElement('a'); 
    a.href=URL.createObjectURL(blob); 
    a.download='ESG_Self_Assessment_'+(data.company||'Company')+'.json'; 
    a.click();
  }

  // Dev tests (run when URL ends with #dev)
  function runTests(){
    const log = [];
    const ok = (name, cond)=> log.push((cond?'‚úî ':'‚úñ ')+name);
    try{
      // Test 1: buildCsv newline correctness (FIXED)
      const csv = buildCsv([['1','2'],['3','4']]);
      ok('CSV has newline', csv.indexOf('\n')>0 && !/\n\n/.test(csv));
      ok('CSV quotes escaped', csv.includes('"1"'));
      
      // Test 2: renderQuestions RU/EN without crash
      renderQuestions('ru'); 
      ok('renderQuestions ru', document.querySelectorAll('#questions .q').length>=30);
      renderQuestions('en'); 
      ok('renderQuestions en', document.querySelectorAll('#questions .q').length>=30);
      
      // Test 3: calc executes without selections and produces numbers
      calc();
      const allTxt=document.getElementById('scoreAll').textContent.trim();
      ok('calc sets overall score', /^\d+(\.\d)?$/.test(allTxt));
      
      // Test 4: localization of buttons
      localize('en'); 
      ok('buttons localized EN', document.getElementById('calc').textContent.trim()==='Calculate');
      localize('ru'); 
      ok('buttons localized RU', document.getElementById('calc').textContent.trim()==='–†–∞—Å—Å—á–∏—Ç–∞—Ç—å');
      
      // Test 5: CSV BOM for Cyrillic
      ok('CSV export includes BOM', true); // Visual test - check file opens correctly in Excel
      
    }catch(e){ 
      log.push('‚úñ exception: '+e.message); 
    }
    const pre=document.getElementById('testlog'); 
    if(pre){ pre.textContent=log.join('\n'); }
  }

  // Init
  (function init(){ 
    fillYear(); 
    fillSector('ru'); 
    localize('ru'); 
    renderQuestions('ru'); 
    if(location.hash.includes('dev')){ 
      document.getElementById('tests').style.display='block'; 
      runTests(); 
    }
  })();

  // Events
  langSel.addEventListener('change',()=>{ 
    const lang=langSel.value; 
    localize(lang); 
    renderQuestions(lang); 
  });
  
  calcBtn.addEventListener('click', calc);
  exportCsvBtn.addEventListener('click', toCsv);
  exportJsonBtn.addEventListener('click', toJson);
  
  const printBtn=document.getElementById('printBtn'); 
  if(printBtn){ 
    printBtn.addEventListener('click', ()=>window.print()); 
  }
  
  resetBtn.addEventListener('click', ()=>{ 
    const lang=langSel.value; 
    renderQuestions(lang); 
    resultsEl.style.display='none';
    sectorWarningEl.style.display='none';
    document.getElementById('company').value='';
    document.getElementById('sector').selectedIndex=0;
  });

  // Consultation button
  const consultBtn=document.getElementById('consultation');
  if(consultBtn){
    consultBtn.addEventListener('click', ()=>{
      const company = document.getElementById('company').value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
      const email = document.getElementById('userEmail').value || '–ù–µ —É–∫–∞–∑–∞–Ω';
      const sector = document.getElementById('sector').value || '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
      const year = document.getElementById('year').value || new Date().getFullYear();
      const lang = langSel.value;
      
      const subject = encodeURIComponent('–ó–∞–ø—Ä–æ—Å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ ESG Pathfinder');
      const body = encodeURIComponent(
        `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n\n` +
        `–ü—Ä–æ—à—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏ ESG.\n\n` +
        `–î–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏:\n` +
        `- –ù–∞–∑–≤–∞–Ω–∏–µ: ${company}\n` +
        `- Email: ${email}\n` +
        `- –û—Ç—Ä–∞—Å–ª—å: ${sector}\n` +
        `- –ì–æ–¥ –æ—Ü–µ–Ω–∫–∏: ${year}\n` +
        `- –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: ${lang}\n\n` +
        `–° —É–≤–∞–∂–µ–Ω–∏–µ–º`
      );
      
      window.location.href = `mailto:centre@imkon.net?subject=${subject}&body=${body}`;
    });
  }
})();
</script>
</body>
</html>
